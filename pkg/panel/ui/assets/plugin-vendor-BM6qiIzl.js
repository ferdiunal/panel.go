import{j as l}from"./react-vendor-DO-l_wfL.js";class a{registry=new Map;register(e,t){this.registry.set(e,t)}get(e){return this.registry.get(e)}has(e){return this.registry.has(e)}getAll(){return new Map(this.registry)}render(e,t){const i=this.get(e.view)??this.get(e.type)??this.get("text");return i?l.jsx(i,{field:e,...t},e.key):(console.warn(`No component registered for field type: ${e.type} or view: ${e.view}`),null)}}const r=new a;class g{plugins=new Map;initialized=!1;register(e){if(this.plugins.has(e.name)){console.warn(`Plugin '${e.name}' is already registered. Skipping.`);return}this.plugins.set(e.name,e)}get(e){return this.plugins.get(e)}getAll(){return Array.from(this.plugins.values())}count(){return this.plugins.size}has(e){return this.plugins.has(e)}clear(){this.plugins.clear(),this.initialized=!1}getMetadata(){return this.getAll().map(e=>({name:e.name,version:e.version,description:e.description,author:e.author}))}async initialize(){if(this.initialized){console.warn("Plugins already initialized. Skipping.");return}for(const e of this.getAll())try{e.init&&await e.init()}catch(t){console.error(`Failed to initialize plugin '${e.name}':`,t)}this.initialized=!0}async cleanup(){for(const e of this.getAll())try{e.cleanup&&await e.cleanup()}catch(t){console.error(`Failed to cleanup plugin '${e.name}':`,t)}this.initialized=!1}getFields(){const e=new Map;for(const t of this.getAll())if(t.fields)for(const i of t.fields){if(e.has(i.type)){console.warn(`Field type '${i.type}' from plugin '${t.name}' is already registered. Skipping.`);continue}if(e.set(i.type,i.component),!i.type.endsWith("-form")&&!i.type.endsWith("-index")&&!i.type.endsWith("-detail")){const n=`${i.type}-form`;e.has(n)||e.set(n,i.component)}}return e}getWidgets(){const e=new Map;for(const t of this.getAll())if(t.widgets)for(const i of t.widgets){if(e.has(i.type)){console.warn(`Widget type '${i.type}' from plugin '${t.name}' is already registered. Skipping.`);continue}e.set(i.type,i.component)}return e}getRoutes(){const e=[];for(const t of this.getAll())t.routes&&e.push(...t.routes);return e}getPages(){const e=[];for(const t of this.getAll())t.pages&&e.push(...t.pages);return e}}const o=new g;async function u(){try{await o.initialize();const s=o.getFields();let e=0,t=0;for(const[i,n]of s.entries()){if(r.has(i)){console.warn(`[Plugin System] Field type '${i}' conflicts with core field. Skipping.`),t++;continue}r.register(i,n),e++}}catch(s){throw console.error("[Plugin System] Failed to initialize plugins:",s),s}}export{r as f,u as i};
